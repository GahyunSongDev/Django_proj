{% extends 'base.html' %}

{% block title %}
    Allie's Daily Blog
{% endblock %}

{% block content %}

<h1 class="text-center">My Daily Blog</h1>
<hr>

{% if object_list %}
        {% csrf_token %}
        <input type="hidden" name="source" value="daily">

        {% if user.is_authenticated %}
            <div class="text-end">
                <button type="button" class="btn" id="post-button" 
                    style="border: 2px solid rgb(25, 135, 84); color: black; font-weight: bold;">POST</button>
            </div>
        {% endif %}
        
        <br/><br/>

        <ul style="list-style-type: none; padding-left: 0;">
            {% for post in object_list %}
                {% if post.category == 'daily' %}
                    <li>
                        <label for="post-{{ post.pk }}">
                            <a href="{% url 'dailyblog-article-detail' post.pk %}" style="margin-right: 80px; color: black;">
                                {{ post.title }}
                            </a>
                            <span style="color: gray;">
                                By {{ post.author.first_name }} {{ post.author.last_name }} || ( {{ post.post_date }} )
                            </span>                        
                        </label>

                        <!-- If the logged-in user is the post's author, show the DELETE button -->
                        {% if post.author.username == user.username or user.is_staff  %}
                            <form action="{% url 'delete_post' post.pk %}" method="post" style="display: inline;" onsubmit="return confirmDelete();">
                                {% csrf_token %}
                                <input type="hidden" name="source" value="daily">
                                <button type="submit" class="btn btn-sm " style="color: red;">DELETE</button>
                            </form>
                        {% endif %}

                    </li>
                    <br/>  <!-- Blank line between posts -->
                {% endif %}
            {% endfor %}
        </ul>
    </form>
{% else %}
    <p>No posts available. <a href="{% url 'add_post' %}?source=daily">Add a new post</a></p>
{% endif %}

<script>
    document.getElementById('post-button').addEventListener('click', function() {
        window.location.href = "{% url 'add_post' %}?source=daily";
    });

    function confirmDelete() {
        return confirm('Are you sure you want to delete this post?');
    }
</script>

{% endblock %}
